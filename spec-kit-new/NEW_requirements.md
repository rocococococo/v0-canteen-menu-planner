# Requirements — Truth from ui-current.md (2025-11-22)

## 已实现（UI 内存态）
- R-01 日/周/月/年视图切换保留选中日期。
- R-02 顶部导航 < / 今天 / > 按视图粒度跳转并同步 Inspector。
- R-03 所有视图与 Inspector 显示农历/节假日/节气。
- R-04 Inspector 显示草稿/已提交计数与会话列表，仅桌面端展示。
- R-05 同日同食堂同餐别仅能创建一次，重复 Toast 报错。
- R-06 Session 卡片可折叠，提交后自动收起。
- R-07 草稿 Session 可添加/编辑/删除菜品；新增菜品自动聚焦。
- R-08 菜品可添加/编辑/删除原料；新增原料自动聚焦；单位下拉含自定义。
- R-09 删除菜品即时生效，无确认/Toast。
- R-10 Session 删除需双击确认，3 秒自动重置。
- R-11 提交菜单需双击确认，状态变提交、徽章变蓝、锁定编辑、自动折叠、Toast 成功。
- R-12 提交后不可编辑/新增/删除菜品原料；仍可删除整个 Session。
- R-13 搜索框仅有 UI 展开/收起，无过滤逻辑（占位）。
- R-14 数据仅存内存，刷新丢失；ID 依赖 Math.random。

## 待实现（近期批准的功能）
- P-01 持久化：Session/Dish/Ingredient 首版即写入 PostgreSQL，通过 `/api/v1/sessions`；刷新后数据可恢复。
- P-02 ID 安全：前端临时 UUID，后端落库 UUID 回写；拒绝 Math.random。
- P-03 API 幂等：创建同业务键返回 409 并附当前记录；所有响应返回最新资源态。
- P-04 基础鉴权：planner 可写所属窗口，viewer 只读；无权限返回 403。
- P-05 表单校验：菜名/份数必填且非负，原料名/数量必填且非负，单位必选；无效时禁用提交并提示。
- P-06 搜索/过滤：至少支持按食堂、餐别、菜名过滤 Inspector，月/周视图指示跟随。
- P-07 反馈补全：创建/删除成功 toast；删除提供可选撤销窗口；保持现有双击确认。
- P-08 移动端编辑：提供抽屉/全屏 Inspector，CRUD 与桌面一致。
- P-09 审计：写操作记录 actor、业务键、操作、时间；存库或事件流。

## Future / Roadmap（保留价值，未排期）
- F-01 对接智慧食堂 API：入站同步表，任务调度，失败重试与告警。
- F-02 高级 RBAC：自定义权限集、作用域组合、权限审计。
- F-03 采购/供应商指派/采购单、验收、销售导入、分析报表与导出。
- F-04 文件/图片上传（菜品图片、验收凭证）。
- F-05 数据保护：速率限制、灰度开关、字段级加密（如涉及敏感信息）。
